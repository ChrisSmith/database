SELECT
    100.00 * SUM(
        CASE
            WHEN p_type LIKE 'PROMO%'
            THEN l_extendedprice * (1 - l_discount)
            ELSE 0
        END
    ) / SUM(l_extendedprice * (1 - l_discount)) AS promo_revenue
FROM
    lineitem,
    part
WHERE
    l_partkey = p_partkey
    AND l_shipdate >= date '1995-09-01'
    AND l_shipdate < date '1995-09-01' + interval '1' month;


Original
Project(100.00 * SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)) / SUM(l_extendedprice * cast(1 as Decimal) - l_discount), rows=6001215) -> .promo_revenue
 Agg(SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), SUM(l_extendedprice * cast(1 as Decimal) - l_discount)) group by (, rows=6001215) -> .SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), .SUM(l_extendedprice * cast(1 as Decimal) - l_discount) 
    JoinSet(lineitem (Inner) x part (Inner), rows=6001215) -> .l_orderkey, .l_partkey, .l_suppkey, .l_linenumber, .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate, .l_commitdate, .l_receiptdate, .l_shipinstruct, .l_shipmode, .l_comment, .p_partkey, .p_name, .p_mfgr, .p_brand, .p_type, .p_size, .p_container, .p_retailprice, .p_comment    
    BinaryEdge { Expression = l_partkey = p_partkey, One = lineitem, Two = part }
    UnaryEdge { Expression = l_shipdate >= 09/01/1995 00:00:00, Relation = lineitem }
    UnaryEdge { Expression = l_shipdate < 10/01/1995 00:00:00, Relation = lineitem }
       Scan(lineitem, rows=6001215) -> .l_orderkey, .l_partkey, .l_suppkey, .l_linenumber, .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate, .l_commitdate, .l_receiptdate, .l_shipinstruct, .l_shipmode, .l_comment       
       Scan(part, rows=200000) -> .p_partkey, .p_name, .p_mfgr, .p_brand, .p_type, .p_size, .p_container, .p_retailprice, .p_comment       


Optimized
Project(100.00 * SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)) / SUM(l_extendedprice * cast(1 as Decimal) - l_discount), rows=1200243) -> .promo_revenue
 Agg(SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), SUM(l_extendedprice * cast(1 as Decimal) - l_discount)) group by (, rows=1200243) -> .SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), .SUM(l_extendedprice * cast(1 as Decimal) - l_discount) 
    Join(Inner on l_partkey = p_partkey, rows=1200243) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate, .p_partkey, .p_type    
       Filter(l_shipdate < 10/01/1995 00:00:00, rows=1200243) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate       
          Filter(l_shipdate >= 09/01/1995 00:00:00, rows=1200243) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate          
             Scan(lineitem, rows=6001215) with projection  -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate             
    
       Scan(part, rows=200000) with projection  -> .p_partkey, .p_type       


Cost Optimized
Project(100.00 * SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)) / SUM(l_extendedprice * cast(1 as Decimal) - l_discount)) cost (output_rows=1200243, cpu=2400486, disk=0, total=41413) -> .promo_revenue
 UngroupedAggregate(SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), SUM(l_extendedprice * cast(1 as Decimal) - l_discount)) cost (output_rows=1200243, cpu=2400486, disk=0, total=39012) -> .SUM(CASE(WHEN starts_with(p_type, PROMO) THEN l_extendedprice * cast(1 as Decimal) - l_discount)), .SUM(l_extendedprice * cast(1 as Decimal) - l_discount) 
    HashJoin(Inner p_partkey, l_partkey) cost (output_rows=1200243, cpu=1600243, disk=0, total=36612) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate, .p_partkey, .p_type    
       Filter(l_shipdate < 10/01/1995 00:00:00) cost (output_rows=1200243, cpu=4800972, disk=0, total=34811) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate       
          Filter(l_shipdate >= 09/01/1995 00:00:00) cost (output_rows=1200243, cpu=24004860, disk=0, total=30010) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate          
             FileScan({SolutionDirectory}tpch/1/lineitem2.parquet) cost (output_rows=6001215, cpu=6001215, disk=49, total=6005) -> .l_partkey, .l_extendedprice, .l_discount, .l_shipdate    
       FileScan({SolutionDirectory}tpch/1/part2.parquet) cost (output_rows=200000, cpu=200000, disk=2, total=200) -> .p_partkey, .p_type