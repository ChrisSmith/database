select
    l_returnflag,
    l_linestatus,
    count(*) as count_order,
    sum(l_quantity) as sum_qty,
    sum(l_extendedprice) as sum_base_price,

    avg(l_quantity) as avg_qty,
    avg(l_extendedprice) as avg_price,
    avg(l_discount) as avg_disc,
    
    sum(l_extendedprice*(1-l_discount)*(1+l_tax)) as sum_charge,
    sum(l_extendedprice*(1-l_discount)) as sum_disc_price
from lineitem
where l_shipdate <= date '1998-12-01' - interval '30' day
group by l_returnflag, l_linestatus
order by l_returnflag, l_linestatus;


Original
Project(l_returnflag, l_linestatus, count_order, sum_qty, sum_base_price, avg_qty, avg_price, avg_disc, sum_charge, sum_disc_price, rows=1200243) -> .l_returnflag, .l_linestatus, .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price
 Sort(l_returnflag ASC, l_linestatus ASC), rows=1200243 -> .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price, .l_returnflag, .l_linestatus 
    Agg(count(*), sum(l_quantity), sum(l_extendedprice), avg(l_quantity), avg(l_extendedprice), avg(l_discount), sum(cast(l_extendedprice as Decimal38) * 1 - l_discount * 1 + l_tax), sum(l_extendedprice * 1 - l_discount), l_returnflag, l_linestatus) group by (l_returnflag, l_linestatus, rows=1200243) -> .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price, .l_returnflag, .l_linestatus    
       Filter(l_shipdate <= 11/01/1998 00:00:00, rows=1200243) -> .l_orderkey, .l_partkey, .l_suppkey, .l_linenumber, .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate, .l_commitdate, .l_receiptdate, .l_shipinstruct, .l_shipmode, .l_comment       
          Scan(lineitem, rows=6001215) -> .l_orderkey, .l_partkey, .l_suppkey, .l_linenumber, .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate, .l_commitdate, .l_receiptdate, .l_shipinstruct, .l_shipmode, .l_comment          


Optimized
Project(l_returnflag, l_linestatus, count_order, sum_qty, sum_base_price, avg_qty, avg_price, avg_disc, sum_charge, sum_disc_price, rows=1200243) -> .l_returnflag, .l_linestatus, .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price
 Sort(l_returnflag ASC, l_linestatus ASC), rows=1200243 -> .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price, .l_returnflag, .l_linestatus 
    Agg(count(*), sum(l_quantity), sum(l_extendedprice), avg(l_quantity), avg(l_extendedprice), avg(l_discount), sum(cast(l_extendedprice as Decimal38) * 1 - l_discount * 1 + l_tax), sum(l_extendedprice * 1 - l_discount), l_returnflag, l_linestatus) group by (l_returnflag, l_linestatus, rows=1200243) -> .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price, .l_returnflag, .l_linestatus    
       Filter(l_shipdate <= 11/01/1998 00:00:00, rows=1200243) -> .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate       
          Scan(lineitem, rows=6001215) with projection  -> .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate          


Cost Optimized
Project(l_returnflag, l_linestatus, count_order, sum_qty, sum_base_price, avg_qty, avg_price, avg_disc, sum_charge, sum_disc_price) cost (output_rows=1200243, cpu=12002430, disk=0, total=151234) -> .l_returnflag, .l_linestatus, .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price
 Sort(l_returnflag ASC, l_linestatus ASC) cost (output_rows=1200243, cpu=48009720, disk=0, total=139232) -> .l_returnflag, .l_linestatus, .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price 
    HashAggregate(l_returnflag, l_linestatus, count(*), sum(l_quantity), sum(l_extendedprice), avg(l_quantity), avg(l_extendedprice), avg(l_discount), sum(cast(l_extendedprice as Decimal38) * 1 - l_discount * 1 + l_tax), sum(l_extendedprice * 1 - l_discount)) cost (output_rows=1200243, cpu=43208748, disk=0, total=91222) -> .l_returnflag, .l_linestatus, .count_order, .sum_qty, .sum_base_price, .avg_qty, .avg_price, .avg_disc, .sum_charge, .sum_disc_price    
       Filter(l_shipdate <= 11/01/1998 00:00:00) cost (output_rows=1200243, cpu=42008505, disk=0, total=48013) -> .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate       
          FileScan({SolutionDirectory}tpch/1/lineitem2.parquet) cost (output_rows=6001215, cpu=6001215, disk=49, total=6005) -> .l_quantity, .l_extendedprice, .l_discount, .l_tax, .l_returnflag, .l_linestatus, .l_shipdate